<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - –ö–∞–≤–∫–∞–∑–¢–æ—Ä–≥ 07</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 20px;
        }

        .admin-header {
            background: linear-gradient(135deg, var(--primary-green), var(--light-green));
            color: white;
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            text-align: center;
        }

        .admin-header h1 {
            margin: 0;
            font-size: 2.5rem;
        }

        .admin-header p {
            margin: 0.5rem 0 0;
            opacity: 0.9;
        }

        .admin-section {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .admin-section h2 {
            color: var(--primary-green);
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-dark);
            font-weight: 600;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-green);
        }

        .form-group select:disabled {
            background: #f5f5f5;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .btn-admin {
            padding: 1rem 2rem;
            background: linear-gradient(135deg, var(--primary-green), var(--light-green));
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .btn-admin:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(45, 80, 22, 0.3);
        }

        .btn-admin-secondary {
            background: linear-gradient(135deg, #666, #888);
        }

        .btn-admin-danger {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }

        .products-list {
            display: grid;
            gap: 1rem;
        }

        .product-item-admin {
            background: var(--bg-light);
            padding: 1.5rem;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .product-item-admin-info {
            flex: 1;
        }

        .product-item-admin-info h3 {
            margin: 0 0 0.5rem;
            color: var(--primary-green);
        }

        .product-item-admin-info p {
            margin: 0.25rem 0;
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .product-item-admin-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }

        .image-preview {
            max-width: 200px;
            max-height: 200px;
            margin-top: 0.5rem;
            border-radius: 8px;
            display: none;
            border: 2px solid #e0e0e0;
            padding: 5px;
            background: var(--bg-light);
        }

        .image-preview.show {
            display: block;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .file-input-wrapper input[type="file"] {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            cursor: pointer;
            transition: border-color 0.3s ease;
            background: white;
        }

        .file-input-wrapper input[type="file"]:hover {
            border-color: var(--primary-green);
        }

        .file-input-wrapper input[type="file"]:focus {
            outline: none;
            border-color: var(--primary-green);
        }

        .file-input-info {
            margin-top: 0.5rem;
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .remove-image-btn {
            margin-top: 0.5rem;
            padding: 0.5rem 1rem;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            display: none;
        }

        .remove-image-btn.show {
            display: inline-block;
        }

        .remove-image-btn:hover {
            background: #c82333;
        }

        .loading-indicator {
            display: none;
            margin-top: 0.5rem;
            color: var(--primary-green);
            font-size: 0.9rem;
        }

        .loading-indicator.show {
            display: block;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .edit-mode {
            background: #fff3cd;
            border: 2px solid #ffc107;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
        }

        .form-actions .btn-admin {
            flex: 1;
        }

        .btn-cancel {
            background: linear-gradient(135deg, #6c757d, #5a6268);
        }

        .btn-cancel:hover {
            background: linear-gradient(135deg, #5a6268, #495057);
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: none;
        }

        .success-message.show {
            display: block;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 1rem;
            color: var(--primary-green);
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s ease;
        }

        .back-link:hover {
            color: var(--light-green);
        }
    </style>
    <script src="data.js"></script>
</head>
<body>
    <div class="admin-container">
        <a href="index.html" class="back-link">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ —Å–∞–π—Ç</a>
        
        <div class="admin-header">
            <h1>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
            <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏ –ö–∞–≤–∫–∞–∑–¢–æ—Ä–≥ 07</p>
        </div>

        <div class="success-message" id="successMessage">
            –¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!
        </div>

        <div class="error-message" id="errorMessage">
            <span id="errorText"></span>
        </div>

        <div class="admin-section" id="productFormSection">
            <h2 id="formTitle">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h2>
            <form id="productForm">
                <input type="hidden" id="editingProductId" value="">
                <input type="hidden" id="editingCategory" value="">
                <div class="form-group">
                    <label for="productCategory">–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
                    <select id="productCategory" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                        <option value="pallets">–î–µ—Ä–µ–≤—è–Ω–Ω—ã–µ –ø–æ–¥–¥–æ–Ω—ã</option>
                        <option value="drinks">–ì–∞–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞–ø–∏—Ç–∫–∏</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="productName">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ *</label>
                    <input type="text" id="productName" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ï–≤—Ä–æ–ø–∞–ª–ª–µ—Ç">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="productSize">–†–∞–∑–º–µ—Ä/–û–±—ä–µ–º</label>
                        <input type="text" id="productSize" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1200√ó800 –º–º –∏–ª–∏ 0.5 –ª">
                    </div>

                    <div class="form-group">
                        <label for="productPrice">–¶–µ–Ω–∞ (‚ÇΩ) *</label>
                        <input type="number" id="productPrice" required min="0" step="0.01" placeholder="500">
                    </div>
                </div>

                <div class="form-group">
                    <label for="productPriceNote">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –∫ —Ü–µ–Ω–µ</label>
                    <input type="text" id="productPriceNote" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: —Å —É—á–µ—Ç–æ–º –ù–î–°">
                </div>

                <div class="form-group">
                    <label for="productDescription">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea id="productDescription" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞"></textarea>
                </div>

                <div class="form-group">
                    <label for="productBadge">–ë–µ–π–¥–∂</label>
                    <select id="productBadge">
                        <option value="">–ù–µ—Ç</option>
                        <option value="–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ">–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ</option>
                        <option value="–ù–æ–≤–∏–Ω–∫–∞">–ù–æ–≤–∏–Ω–∫–∞</option>
                        <option value="–ê–∫—Ü–∏—è">–ê–∫—Ü–∏—è</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="productIcon">–ò–∫–æ–Ω–∫–∞ (—ç–º–æ–¥–∑–∏)</label>
                    <input type="text" id="productIcon" placeholder="üì¶ –∏–ª–∏ ü•§" maxlength="2">
                </div>

                <div class="form-group">
                    <label for="productImage">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="productImage" accept="image/*" />
                        <div class="file-input-info">–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (JPG, PNG, GIF, WebP). –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 5 –ú–ë</div>
                        <div class="loading-indicator" id="imageLoading">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è...</div>
                    </div>
                    <img id="imagePreview" class="image-preview" alt="–ü—Ä–µ–≤—å—é">
                    <button type="button" class="remove-image-btn" id="removeImageBtn">–£–¥–∞–ª–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</button>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn-admin" id="submitBtn">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
                    <button type="button" class="btn-admin btn-cancel" id="cancelBtn" style="display: none;">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </form>
        </div>

        <div class="admin-section">
            <h2>–î–µ—Ä–µ–≤—è–Ω–Ω—ã–µ –ø–æ–¥–¥–æ–Ω—ã</h2>
            <div class="products-list" id="palletsList"></div>
        </div>

        <div class="admin-section">
            <h2>–ì–∞–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞–ø–∏—Ç–∫–∏</h2>
            <div class="products-list" id="drinksList"></div>
        </div>
    </div>

    <script>
        const productForm = document.getElementById('productForm');
        const productFormSection = document.getElementById('productFormSection');
        const formTitle = document.getElementById('formTitle');
        const submitBtn = document.getElementById('submitBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        const editingProductId = document.getElementById('editingProductId');
        const editingCategory = document.getElementById('editingCategory');
        const successMessage = document.getElementById('successMessage');
        const errorMessage = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');
        const imagePreview = document.getElementById('imagePreview');
        const productImageInput = document.getElementById('productImage');
        const removeImageBtn = document.getElementById('removeImageBtn');
        const imageLoading = document.getElementById('imageLoading');
        let selectedImageBase64 = null;
        let isEditMode = false;

        function showError(message) {
            errorText.textContent = message;
            errorMessage.classList.add('show');
            setTimeout(() => {
                errorMessage.classList.remove('show');
            }, 5000);
        }

        function hideError() {
            errorMessage.classList.remove('show');
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ base64
        function convertFileToBase64(file) {
            return new Promise((resolve, reject) => {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
                if (!file.type.startsWith('image/')) {
                    reject(new Error('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è'));
                    return;
                }

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ (–º–∞–∫—Å–∏–º—É–º 10 –ú–ë –¥–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏)
                if (file.size > 10 * 1024 * 1024) {
                    reject(new Error('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 10 –ú–ë'));
                    return;
                }

                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        // –°–æ–∑–¥–∞–µ–º canvas –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;
                        
                        // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä (1920px –ø–æ –±–æ–ª—å—à–µ–π —Å—Ç–æ—Ä–æ–Ω–µ)
                        const maxDimension = 1920;
                        if (width > maxDimension || height > maxDimension) {
                            if (width > height) {
                                height = (height / width) * maxDimension;
                                width = maxDimension;
                            } else {
                                width = (width / height) * maxDimension;
                                height = maxDimension;
                            }
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ base64 —Å –∫–∞—á–µ—Å—Ç–≤–æ–º 0.85 (—Ö–æ—Ä–æ—à–∏–π –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –∫–∞—á–µ—Å—Ç–≤–æ–º –∏ —Ä–∞–∑–º–µ—Ä–æ–º)
                        const optimizedBase64 = canvas.toDataURL('image/jpeg', 0.85);
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä –ø–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–º–∞–∫—Å–∏–º—É–º 2 –ú–ë –¥–ª—è base64)
                        if (optimizedBase64.length > 2 * 1024 * 1024) {
                            // –ü—Ä–æ–±—É–µ–º —Å –º–µ–Ω—å—à–∏–º –∫–∞—á–µ—Å—Ç–≤–æ–º
                            const optimizedBase642 = canvas.toDataURL('image/jpeg', 0.7);
                            if (optimizedBase642.length > 2 * 1024 * 1024) {
                                reject(new Error('–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ –¥–∞–∂–µ –ø–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.'));
                                return;
                            }
                            resolve(optimizedBase642);
                        } else {
                            resolve(optimizedBase64);
                        }
                    };
                    img.onerror = function() {
                        reject(new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è'));
                    };
                    img.src = e.target.result;
                };
                reader.onerror = function() {
                    reject(new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞'));
                };
                reader.readAsDataURL(file);
            });
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
        productImageInput.addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if (file) {
                imageLoading.classList.add('show');
                hideError();
                
                try {
                    selectedImageBase64 = await convertFileToBase64(file);
                    imagePreview.src = selectedImageBase64;
                    imagePreview.classList.add('show');
                    removeImageBtn.classList.add('show');
                    imageLoading.classList.remove('show');
                } catch (error) {
                    showError(error.message);
                    this.value = '';
                    selectedImageBase64 = null;
                    imagePreview.classList.remove('show');
                    removeImageBtn.classList.remove('show');
                    imageLoading.classList.remove('show');
                }
            } else {
                selectedImageBase64 = null;
                imagePreview.classList.remove('show');
                removeImageBtn.classList.remove('show');
                imageLoading.classList.remove('show');
            }
        });

        // –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        removeImageBtn.addEventListener('click', function() {
            productImageInput.value = '';
            selectedImageBase64 = null;
            productImageInput.dataset.currentImage = '';
            imagePreview.classList.remove('show');
            removeImageBtn.classList.remove('show');
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã
        productForm.addEventListener('submit', async function(e) {
            e.preventDefault();

            hideError();
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
            const category = document.getElementById('productCategory').value;
            if (!category) {
                showError('–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ç–æ–≤–∞—Ä–∞');
                return;
            }

            const productName = document.getElementById('productName').value;
            if (!productName.trim()) {
                showError('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞');
                return;
            }

            const productPrice = document.getElementById('productPrice').value;
            if (!productPrice || parseFloat(productPrice) <= 0) {
                showError('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ü–µ–Ω—É');
                return;
            }

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ –Ω–æ–≤–æ–µ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ, –∏–Ω–∞—á–µ –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–µ
            let productImage = '';
            if (selectedImageBase64 !== null) {
                // –ù–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–æ
                productImage = selectedImageBase64;
            } else if (isEditMode) {
                // –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –Ω–æ –Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –≤—ã–±—Ä–∞–Ω–æ - —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ
                const currentImage = productImageInput.dataset.currentImage || '';
                productImage = currentImage;
            }

            const product = {
                name: productName,
                size: document.getElementById('productSize').value,
                price: parseFloat(productPrice),
                priceNote: document.getElementById('productPriceNote').value,
                description: document.getElementById('productDescription').value,
                badge: document.getElementById('productBadge').value,
                icon: document.getElementById('productIcon').value || 'üì¶',
                image: productImage
            };

            let success = false;
            if (isEditMode && editingProductId.value) {
                // –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                success = productManager.updateProduct(editingCategory.value, parseInt(editingProductId.value), product);
                if (success) {
                    showSuccess('–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!');
                    exitEditMode();
                }
            } else {
                // –†–µ–∂–∏–º –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
                success = productManager.addProduct(category, product);
                if (success) {
                    showSuccess('–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!');
                    resetForm();
                }
            }

            if (success) {
                loadProducts();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É, –µ—Å–ª–∏ –æ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∞
                if (window.opener && !window.opener.closed) {
                    window.opener.location.reload();
                }
            }
        });

        function showSuccess(message = '–¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!') {
            successMessage.textContent = message;
            successMessage.classList.add('show');
            setTimeout(() => {
                successMessage.classList.remove('show');
            }, 3000);
        }

        function resetForm() {
            productForm.reset();
            selectedImageBase64 = null;
            imagePreview.classList.remove('show');
            removeImageBtn.classList.remove('show');
            productImageInput.dataset.currentImage = '';
            exitEditMode();
        }

        function exitEditMode() {
            isEditMode = false;
            editingProductId.value = '';
            editingCategory.value = '';
            formTitle.textContent = '–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä';
            submitBtn.textContent = '–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä';
            cancelBtn.style.display = 'none';
            productFormSection.classList.remove('edit-mode');
            document.getElementById('productCategory').disabled = false; // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é
            resetForm();
        }

        function enterEditMode(product, category) {
            isEditMode = true;
            editingProductId.value = product.id;
            editingCategory.value = category;
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–æ—Ä–º—É –¥–∞–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞
            const categorySelect = document.getElementById('productCategory');
            categorySelect.value = category;
            categorySelect.disabled = true; // –ë–ª–æ–∫–∏—Ä—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            document.getElementById('productName').value = product.name || '';
            document.getElementById('productSize').value = product.size || '';
            document.getElementById('productPrice').value = product.price || '';
            document.getElementById('productPriceNote').value = product.priceNote || '';
            document.getElementById('productDescription').value = product.description || '';
            document.getElementById('productBadge').value = product.badge || '';
            document.getElementById('productIcon').value = product.icon || 'üì¶';
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            if (product.image) {
                selectedImageBase64 = product.image;
                imagePreview.src = product.image;
                imagePreview.classList.add('show');
                removeImageBtn.classList.add('show');
                productImageInput.dataset.currentImage = product.image;
            } else {
                selectedImageBase64 = null;
                imagePreview.classList.remove('show');
                removeImageBtn.classList.remove('show');
                productImageInput.dataset.currentImage = '';
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            formTitle.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä';
            submitBtn.textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è';
            cancelBtn.style.display = 'block';
            productFormSection.classList.add('edit-mode');
            
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Ñ–æ—Ä–º–µ
            productFormSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –æ—Ç–º–µ–Ω—ã
        cancelBtn.addEventListener('click', function() {
            exitEditMode();
        });

        function loadProducts() {
            const products = productManager.getProducts();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–¥–¥–æ–Ω—ã
            const palletsList = document.getElementById('palletsList');
            palletsList.innerHTML = '';
            if (products.pallets && products.pallets.length > 0) {
                products.pallets.forEach(product => {
                    palletsList.appendChild(createProductItem(product, 'pallets'));
                });
            } else {
                palletsList.innerHTML = '<p style="color: var(--text-light);">–¢–æ–≤–∞—Ä–æ–≤ –Ω–µ—Ç</p>';
            }

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞–ø–∏—Ç–∫–∏
            const drinksList = document.getElementById('drinksList');
            drinksList.innerHTML = '';
            if (products.drinks && products.drinks.length > 0) {
                products.drinks.forEach(product => {
                    drinksList.appendChild(createProductItem(product, 'drinks'));
                });
            } else {
                drinksList.innerHTML = '<p style="color: var(--text-light);">–¢–æ–≤–∞—Ä–æ–≤ –Ω–µ—Ç</p>';
            }
        }

        function createProductItem(product, category) {
            const item = document.createElement('div');
            item.className = 'product-item-admin';
            
            const imageHtml = product.image ? 
                `<img src="${product.image}" alt="${product.name}" style="max-width: 100px; max-height: 100px; border-radius: 8px; margin-right: 1rem; object-fit: contain;">` : 
                '';
            
            item.innerHTML = `
                <div style="display: flex; align-items: center; flex: 1;">
                    ${imageHtml}
                    <div class="product-item-admin-info">
                        <h3>${product.name}</h3>
                        ${product.size ? `<p><strong>–†–∞–∑–º–µ—Ä:</strong> ${product.size}</p>` : ''}
                        <p><strong>–¶–µ–Ω–∞:</strong> ${product.price} ‚ÇΩ ${product.priceNote ? `(${product.priceNote})` : ''}</p>
                        ${product.description ? `<p>${product.description}</p>` : ''}
                    </div>
                </div>
                <div class="product-item-admin-actions">
                    <button class="btn-admin btn-admin-secondary btn-small" onclick="editProduct('${category}', ${product.id})">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                    <button class="btn-admin btn-admin-danger btn-small" onclick="deleteProduct('${category}', ${product.id})">–£–¥–∞–ª–∏—Ç—å</button>
                </div>
            `;

            return item;
        }

        function editProduct(category, productId) {
            const products = productManager.getProducts();
            if (products[category]) {
                const product = products[category].find(p => p.id === productId);
                if (product) {
                    enterEditMode(product, category);
                }
            }
        }

        function deleteProduct(category, productId) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä?')) {
                if (productManager.deleteProduct(category, productId)) {
                    loadProducts();
                    // –û–±–Ω–æ–≤–ª—è–µ–º –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É, –µ—Å–ª–∏ –æ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∞
                    if (window.opener) {
                        window.opener.location.reload();
                    }
                }
            }
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–≤–∞—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            loadProducts();
        });

        // –°–ª—É—à–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        window.addEventListener('productsUpdated', () => {
            loadProducts();
        });
    </script>
</body>
</html>
